/*
THIS INFRAGISTICS ULTIMATE SOFTWARE LICENSE  AGREEMENT ("AGREEMENT") LOCATED HERE:
https://www.infragistics.com/legal/license/igultimate-la
https://www.infragistics.com/legal/license/igultimate-eula
GOVERNS THE LICENSING, INSTALLATION AND USE OF INFRAGISTICS SOFTWARE. BY DOWNLOADING AND/OR INSTALLING AND USING INFRAGISTICS SOFTWARE:  you are indicating that you have read and understand this Agreement, and agree to be legally bound by it on behalf of the yourself and your company.
*/
import { BaseDataSource } from "./BaseDataSource";
import { Base, typeCast, Array_$type, Number_$type, fromEnum, markType } from "./type";
import { RearrangedListView } from "./RearrangedListView";
import { DataSourcePropertiesComparer } from "./DataSourcePropertiesComparer";
import { List$1 } from "./List$1";
import { DataSourceExecutionContext } from "./DataSourceExecutionContext";
import { DataSourceLocalDataProvider } from "./DataSourceLocalDataProvider";
import { DataSourceSpecialRow } from "./DataSourceSpecialRow";
import { ISupportsDataChangeNotifications_$type } from "./ISupportsDataChangeNotifications";
import { IDataSourceClonableDataProvider_$type } from "./IDataSourceClonableDataProvider";
import { TransactionType, TransactionType_$type } from "./TransactionType";
import { ISupportsExpansionChangeNotifications_$type } from "./ISupportsExpansionChangeNotifications";
/**
 * @hidden
 */
export let LocalDataSource = /*@__PURE__*/ (() => {
    class LocalDataSource extends BaseDataSource {
        constructor() {
            super();
            this.cz = null;
            this.dc = false;
            this.cy = null;
            this.d0 = null;
            this.c4 = null;
            this.c8 = null;
            this.da = null;
            this.d4 = null;
            this.c6 = null;
            this.dl = new List$1(Array_$type, 0);
            this.db = false;
            this.cx = null;
            this.du = -1;
            this.dm = -1;
            this.dw = -1;
            this.dp = -1;
            this.dx = -1;
            this.dq = -1;
            this.dv = -1;
            this.dn = -1;
            this.dz = -1;
            this.dy = -1;
            this.ds = -1;
            this.dr = -1;
            this.dt = -1;
            this.executionContext = new DataSourceExecutionContext();
            this.v.l = false;
        }
        get_actualBaseDataProvider() {
            return this.actualDataProvider;
        }
        get actualBaseDataProvider() {
            return this.get_actualBaseDataProvider();
        }
        get dataProvider() {
            return this.cz;
        }
        set dataProvider(a) {
            let b = this.cz;
            this.cz = a;
            if (b != this.cz) {
                this.onPropertyUpdated("DataProvider", b, this.cz);
            }
        }
        get actualDataProvider() {
            if (this.cy == null) {
                this.actualDataProvider = this.resolveDataProvider();
            }
            return this.cy;
        }
        set actualDataProvider(a) {
            let b = this.cy;
            this.cy = a;
            if (b != this.cy) {
                this.onPropertyUpdated("ActualDataProvider", b, this.cy);
            }
        }
        get dataSource() {
            return this.d0;
        }
        set dataSource(a) {
            let b = this.d0;
            this.d0 = a;
            if (b != this.d0) {
                this.onPropertyUpdated("ItemsSource", b, this.d0);
            }
        }
        canInitialize() {
            let a = super.canInitialize();
            if (!a) {
                return false;
            }
            return this.dataSource != null;
        }
        get c5() {
            return this.c4;
        }
        set c5(a) {
            this.c4 = a;
            {
                this.actualDataProvider = this.resolveDataProvider();
            }
        }
        resolveDataProvider() {
            let provider_ = new DataSourceLocalDataProvider();
            provider_.executionContext = new DataSourceExecutionContext();
            return provider_;
        }
        propertyUpdatedOverride(a, b, c) {
            super.propertyUpdatedOverride(a, b, c);
            switch (a) {
                case "DataProvider":
                    this.dc = true;
                    this.actualDataProvider = this.dataProvider;
                    break;
                case "ActualDataProvider":
                    if (this.actualDataProvider != null) {
                        this.actualDataProvider.dataSource = this.dataSource;
                        this.actualSchema = this.actualDataProvider.actualSchema;
                        this.actualCount = this.resolveFullCount(this.actualDataProvider.actualCount);
                    }
                    this.queueAutoRefresh();
                    break;
                case "ItemsSource":
                    if (this.actualDataProvider != null) {
                        this.actualDataProvider.dataSource = this.dataSource;
                        this.actualSchema = this.actualDataProvider.actualSchema;
                        this.actualCount = this.resolveFullCount(this.actualDataProvider.actualCount);
                    }
                    this.queueAutoRefresh();
                    break;
            }
        }
        getItemAtIndex(a) {
            if (this.c8 != null && this.c8.a7 != null) {
                return this.c8.a7.item(a);
            }
            else {
                return this.actualDataProvider.getItemAtIndex(a);
            }
        }
        getItemFromKey(a) {
            let b = this.actualPrimaryKey;
            if (b == null || b.length < 1 || this.actualBaseDataProvider == null) {
                return a[0];
            }
            let c = this.c7();
            let d;
            if (this.c8 != null) {
                let e = this.c8.a7.count;
                for (let f = 0; f < e; f++) {
                    d = this.c8.a7.item(f);
                    if (typeCast(DataSourceSpecialRow.$, d) !== null) {
                        let g = d;
                        if (g.rowType == 1 && !this.isSectionContentVisible && this.isSectionHeaderNormalRow) {
                            if (c.i(d, a) == 0) {
                                return d;
                            }
                        }
                    }
                    else if (c.i(d, a) == 0) {
                        return d;
                    }
                }
                return null;
            }
            if (this.actualDataProvider != null && this.actualDataProvider.isKeyIndexLookupSupported) {
                let h = this.actualDataProvider.indexOfKey(a);
                return this.actualDataProvider.getItemAtIndex(h);
            }
            if (this.actualDataProvider != null) {
                let i = this.actualDataProvider.actualCount;
                for (let j = 0; j < i; j++) {
                    d = this.actualDataProvider.getItemAtIndex(j);
                    if (c.i(d, a) == 0) {
                        return d;
                    }
                }
            }
            return null;
        }
        getItemPropertyAtIndex(a, b) {
            let c;
            if (this.c8 != null) {
                c = this.c8.a7.item(a);
            }
            else {
                c = this.actualDataProvider.getItemAtIndex(a);
            }
            if (c == null) {
                return null;
            }
            let item_ = c;
            if ((item_ != null && item_.$$isSpecialRow !== undefined)) {
                return this.getSpecialRowItemValue(c, b);
            }
            if (this.ar()) {
                let d = this.ao(c, b);
                if (d) {
                    let e = this.a2(c, b);
                    return e;
                }
            }
            return this.actualDataProvider.getItemValue(c, b);
        }
        c3() {
            return this.actualDataProvider;
        }
        de() {
            return this.dl != null && this.dl.count > 0;
        }
        refreshInternalOverride() {
            super.refreshInternalOverride();
            if (this.actualDataProvider != null) {
                if (this.df() || this.dg() || this.dh() || this.di() || this.de()) {
                    if (this.c8 == null) {
                        if (this.da == null) {
                            this.da = new LocalDataSourceViewUpdateNotifier(this);
                        }
                        this.c8 = new RearrangedListView(this.actualDataProvider);
                        this.c8.ab = this.da;
                        this.c8.ad = new LocalDataSourceViewExpansionNotifier(this);
                    }
                    this.ensureComparables(this.actualDataProvider.actualSchema);
                    this.c8.av = this.shouldEmitSectionHeaders && this.aq;
                    this.c8.au = this.shouldEmitSectionFooters && this.aq;
                    this.c8.aw = this.shouldEmitShiftedRows;
                    this.c8.ax = this.shouldEmitSummaryRows;
                    this.c8.cc(this.dl);
                    this.c8.a3 = this.dk();
                    this.c8.a2 = this.dj();
                    this.c8.p = this.c7();
                    this.c8.ae = this.groupDescriptions;
                    this.c8.af = this.sortDescriptions;
                    this.c8.ag = this.summaryDescriptions;
                    this.c8.l = this.summaryScope;
                    this.c8.am = this.includeSummaryRowsInSection;
                    this.c8.as = this.isSectionSummaryRowsAtBottom;
                    this.c8.j = this.sectionHeaderDisplayMode;
                    this.c8.m = this;
                    this.c8.ap = this.groupDescriptions != null && this.groupDescriptions.k.count > 0;
                    this.c8.t = this.c9();
                    this.c8.b7();
                    this.actualSchema = this.actualDataProvider.actualSchema;
                    this.actualCount = this.c8.a7.count;
                }
                else {
                    let a = this.c3();
                    this.actualSchema = this.actualDataProvider.actualSchema;
                    if (a != null) {
                        this.actualCount = a.actualCount;
                    }
                    else {
                        this.actualCount = 0;
                    }
                    if (this.c8 != null) {
                        this.c8.ab = null;
                        this.c8 = null;
                        this.onBroadcastClearItems();
                    }
                }
            }
            else {
                this.actualCount = 0;
                this.actualSchema = null;
            }
        }
        get_isItemIndexLookupSupported() {
            return true;
        }
        get_isKeyIndexLookupSupported() {
            return true;
        }
        indexOfItem(a) {
            if (this.c8 != null) {
                return this.c8.a7.indexOf(a);
            }
            if (this.actualDataProvider != null && this.actualDataProvider.isItemIndexLookupSupported) {
                return this.actualDataProvider.indexOfItem(a);
            }
            if (this.actualDataProvider != null) {
                let b = this.actualDataProvider.actualCount;
                let c;
                for (let d = 0; d < b; d++) {
                    c = this.actualDataProvider.getItemAtIndex(d);
                    if (this.dd(c, a)) {
                        return d;
                    }
                }
            }
            return -1;
        }
        dd(a, b) {
            if (a == null && b == null) {
                return true;
            }
            if (a == null || b == null) {
                return false;
            }
            return Base.equalsStatic(a, b);
        }
        indexOfKey(a) {
            let b = this.actualPrimaryKey;
            if (b == null || b.length < 1 || this.actualBaseDataProvider == null) {
                return this.indexOfItem(a[0]);
            }
            let c = this.c7();
            let d;
            if (this.c8 != null) {
                let e = this.c8.a7.count;
                for (let f = 0; f < e; f++) {
                    d = this.c8.a7.item(f);
                    if (typeCast(DataSourceSpecialRow.$, d) !== null) {
                        let g = d;
                        if (g.rowType == 1 && !this.isSectionContentVisible && this.isSectionHeaderNormalRow) {
                            if (c.i(d, a) == 0) {
                                return f;
                            }
                        }
                    }
                    else if (c.i(d, a) == 0) {
                        return f;
                    }
                }
                return -1;
            }
            if (this.actualDataProvider != null && this.actualDataProvider.isKeyIndexLookupSupported) {
                return this.actualDataProvider.indexOfKey(a);
            }
            if (this.actualDataProvider != null) {
                let h = this.actualDataProvider.actualCount;
                for (let i = 0; i < h; i++) {
                    d = this.actualDataProvider.getItemAtIndex(i);
                    if (c.i(d, a) == 0) {
                        return i;
                    }
                }
            }
            return -1;
        }
        onActualPrimaryKeyChangedOverrride(a, b) {
            super.onActualPrimaryKeyChangedOverrride(a, b);
            this.c6 = null;
        }
        c7() {
            if (this.c6 != null) {
                return this.c6;
            }
            if (this.actualPrimaryKey == null) {
                this.c6 = new DataSourcePropertiesComparer(null, null, null, this);
                return this.c6;
            }
            let a = new Array(this.actualPrimaryKey.length);
            for (let b = 0; b < a.length; b++) {
                a[b] = 0;
            }
            this.c6 = new DataSourcePropertiesComparer(this.actualPrimaryKey, a, this.d, this);
            return this.c6;
        }
        c9() {
            if (this.filterExpressions.k.count == 0) {
                return null;
            }
            let a = this.actualDataProvider;
            let b = this.actualDataProvider.actualSchema;
            let c = this.filterExpressions.k;
            let d = (e) => {
                for (let f = 0; f < c.count; f++) {
                    if (!c.item(f).match(e, a, b)) {
                        return false;
                    }
                }
                return true;
            };
            return d;
        }
        dk() {
            let a = 0;
            if (this.sortDescriptions.k.count == 0 && (this.groupDescriptions == null || this.groupDescriptions.k.count == 0)) {
                return null;
            }
            a = this.sortDescriptions.k.count;
            if (this.groupDescriptions != null) {
                a += this.groupDescriptions.k.count;
            }
            let b = new Array(a);
            let c = new Array(a);
            let d = 0;
            if (this.groupDescriptions != null) {
                for (let e = 0; e < this.groupDescriptions.k.count; e++) {
                    b[e] = this.groupDescriptions.k.item(e).propertyName;
                    c[e] = this.groupDescriptions.k.item(e).direction;
                    d++;
                }
            }
            for (let f = 0; f < this.sortDescriptions.k.count; f++) {
                b[f + d] = this.sortDescriptions.k.item(f).propertyName;
                c[f + d] = this.sortDescriptions.k.item(f).direction;
            }
            return new DataSourcePropertiesComparer(b, c, this.d, this);
        }
        dj() {
            if (this.groupDescriptions == null || this.groupDescriptions.k.count < 1) {
                return null;
            }
            let a = 0;
            a = this.groupDescriptions.k.count;
            let b = new Array(a);
            let c = new Array(a);
            if (this.groupDescriptions != null) {
                for (let d = 0; d < this.groupDescriptions.k.count; d++) {
                    b[d] = this.groupDescriptions.k.item(d).propertyName;
                    c[d] = this.groupDescriptions.k.item(d).direction;
                }
            }
            return new DataSourcePropertiesComparer(b, c, this.d, this);
        }
        dg() {
            if (this.groupDescriptions == null || this.groupDescriptions.k.count < 1) {
                return false;
            }
            if (this.actualDataProvider == null) {
                return false;
            }
            if (this.actualDataProvider.isGroupingSupported) {
                return false;
            }
            return true;
        }
        dh() {
            if (this.sortDescriptions == null || this.sortDescriptions.k.count < 1) {
                return false;
            }
            if (this.actualDataProvider == null) {
                return false;
            }
            if (this.actualDataProvider.isSortingSupported) {
                return false;
            }
            return true;
        }
        df() {
            return this.filterExpressions != null && this.filterExpressions.k.count > 0;
        }
        di() {
            if (this.summaryDescriptions == null || this.summaryDescriptions.k.count < 1) {
                return false;
            }
            return true;
        }
        onClearItemsOverride() {
            if (this.c8 != null) {
                this.c8.notifyClearItems();
                this.queueAutoRefresh();
            }
            else {
                super.onClearItemsOverride();
            }
        }
        onSetItemOverride(a, b, c) {
            if (this.c8 != null) {
                this.c8.notifySetItem(a, b, c);
            }
            else {
                super.onSetItemOverride(a, b, c);
            }
        }
        onInsertItemOverride(a, b) {
            if (this.c8 != null) {
                this.c8.notifyInsertItem(a, b);
            }
            else {
                super.onInsertItemOverride(a, b);
            }
        }
        onRemoveItemOverride(a, b) {
            if (this.c8 != null) {
                this.c8.notifyRemoveItem(a, b);
            }
            else {
                super.onRemoveItemOverride(a, b);
            }
        }
        d6() {
            this.actualCount = this.c8.a7.count;
            this.onBroadcastClearItems();
        }
        d9(a, b, c) {
            this.actualCount = this.c8.a7.count;
            this.onBroadcastSetItem(a, b, c);
        }
        d7(a, b) {
            this.actualCount = this.c8.a7.count;
            this.onBroadcastInsertItem(a, b);
        }
        d8(a, b) {
            this.actualCount = this.c8.a7.count;
            this.onBroadcastRemoveItem(a, b);
        }
        pinRow(a) {
            super.pinRow(a);
            this.du = -1;
            this.dm = -1;
            if (this.c8 != null) {
                this.dl.add(a);
                this.c8.b6(a);
            }
            else {
                this.dl.add(a);
                this.queueAutoRefresh();
            }
        }
        unpinRow(a) {
            super.unpinRow(a);
            let b = this.c7();
            if (this.c8 != null) {
                for (let c = this.dl.count - 1; c >= 0; c--) {
                    let d = this.dl._inner[c];
                    if (d.length != a.length) {
                        continue;
                    }
                    if (b.h(d, a) == 0) {
                        this.dl.removeAt(c);
                        this.c8.cd(d);
                    }
                }
            }
            else {
                for (let e = this.dl.count - 1; e >= 0; e--) {
                    let f = this.dl._inner[e];
                    if (f.length != a.length) {
                        continue;
                    }
                    if (b.h(f, a) == 0) {
                        this.dl.removeAt(e);
                    }
                }
                this.queueAutoRefresh();
            }
            this.du = -1;
            this.dm = -1;
        }
        clearPinnedRows() {
            for (let a = this.dl.count - 1; a >= 0; a--) {
                this.unpinRow(this.dl._inner[a]);
            }
        }
        isRowPinned(a) {
            if (this.c8 == null) {
                return false;
            }
            let b = this.getItemAtIndex(a);
            if (b == null) {
                return false;
            }
            let item_ = b;
            if ((item_ != null && item_.$$isSpecialRow !== undefined)) {
                if (item_.rowType == 3) {
                    return true;
                }
            }
            let c = this.c7();
            let d;
            if (this.actualPrimaryKey == null) {
                d = new Array(1);
                d[0] = b;
            }
            else {
                let e = this.actualPrimaryKey;
                let f = e.length;
                d = new Array(f);
                for (let g = 0; g < f; g++) {
                    d[g] = this.getItemProperty(b, e[g]);
                }
            }
            for (let h = 0; h < this.dl.count; h++) {
                if (c.h(this.dl._inner[h], d) == 0) {
                    return true;
                }
            }
            return false;
        }
        get_isSortingSupported() {
            if (this.externalDataSource != null && !this.db) {
                this.db = true;
                let a = this.externalDataSource.isSortingSupportedOverride;
                this.db = false;
                return a;
            }
            return true;
        }
        get_isFilteringSupported() {
            if (this.externalDataSource != null && !this.db) {
                this.db = true;
                let a = this.externalDataSource.isFilteringSupportedOverride;
                this.db = false;
                return a;
            }
            return true;
        }
        get_isGroupingSupported() {
            if (this.externalDataSource != null && !this.db) {
                this.db = true;
                let a = this.externalDataSource.isGroupingSupportedOverride;
                this.db = false;
                return a;
            }
            return true;
        }
        getStickyRowPriority(a) {
            let b = this.getRowType(a);
            switch (b) {
                case 1: return 100 - this.getRowLevel(a);
                case 2: return 99 - this.getRowLevel(a);
                case 3:
                case 5: return 2;
                case 4: return 3;
            }
            return 1;
        }
        getStickyRowsInRange(a, b) {
            if (this.c8 == null || ((this.groupDescriptions == null || this.groupDescriptions.k.count == 0) && (this.summaryDescriptions == null || this.summaryDescriptions.k.count == 0) && !this.de())) {
                return null;
            }
            let c = null;
            let d = null;
            if (this.c8.a6.count == 1) {
                c = this.c8.a6._inner[0];
                d = this.c8.a6._inner[0];
            }
            else {
                c = this.c8.w(a);
                if (c != null) {
                    while (c.z != -1) {
                        c = this.c8.a6._inner[c.z];
                    }
                }
                d = this.c8.w(b);
                if (b >= this.c8.a7.count - this.c8.bl) {
                    d = this.c8.v();
                }
            }
            if (c == null || d == null) {
                return null;
            }
            if (c.ae == this.du && c.aa == this.dw && c.af == this.dx && c.ad == this.dv && c.ah == this.dz && c.ag == this.dy && d.ae == this.dm && d.aa == this.dp && d.af == this.dq && d.ad == this.dn && d.ah == this.ds && d.ag == this.dr && this.c8.bl == this.dt) {
                return this.cx;
            }
            this.du = c.ae;
            this.dm = d.ae;
            this.dw = c.aa;
            this.dp = d.aa;
            this.dx = c.af;
            this.dq = d.af;
            this.dv = c.ad;
            this.dn = d.ad;
            this.dz = c.ah;
            this.dy = c.ag;
            this.ds = d.ah;
            this.dr = d.ag;
            this.dt = this.c8.bl;
            if (this.c8.a6.count == 1) {
                this.dm = d.ad;
            }
            let e = 0;
            if (this.shouldEmitSectionHeaders && this.aq) {
                e = 1;
            }
            let f = this.c8.bb();
            let g = new List$1(Number_$type, 0);
            for (let h = c.ae; h <= d.ae; h++) {
                let i = this.c8.a6._inner[h];
                let j = this.c8.a6._inner[h].c.length;
                let k = this.c8.a6._inner[h].v();
                if (this.shouldEmitSectionHeaders && this.aq) {
                    for (let l = 0; l < j; l++) {
                        if (this.c8.a6._inner[h].a[l] != null) {
                            let m = i.af + i.b[l];
                            g.add(m);
                            if (this.summaryScope == 0 || this.summaryScope == 2) {
                                if (i.c[l] && this.includeSummaryRowsInSection && !this.isSectionSummaryRowsAtBottom) {
                                    for (let n = 0; n < f; n++) {
                                        g.add(m + 1 + n);
                                    }
                                }
                            }
                        }
                        if (!this.c8.a6._inner[h].c[l]) {
                            break;
                        }
                    }
                }
                if (this.c8.a6._inner[h].p) {
                    if (this.shouldEmitShiftedRows) {
                        for (let o = 0; o < this.c8.a6._inner[h].aa; o++) {
                            g.add(this.c8.a6._inner[h].af + this.c8.a6._inner[h].ah + o + k);
                        }
                    }
                }
                if (this.summaryScope == 0 || this.summaryScope == 2) {
                    if (this.shouldEmitSummaryRows && this.includeSummaryRowsInSection && this.isSectionSummaryRowsAtBottom) {
                        for (let p = this.c8.a6._inner[h].ag - 1; p >= 0; p--) {
                            if (this.shouldEmitSectionFooters) {
                                g.add(this.c8.a6._inner[h].ad - k - p);
                            }
                            else {
                                g.add(this.c8.a6._inner[h].ad - p);
                            }
                        }
                    }
                }
                if (this.shouldEmitSectionFooters && this.aq) {
                    for (let q = j - 1; q >= 0; q--) {
                        if (!this.c8.a6._inner[h].c[q]) {
                            break;
                        }
                        g.add(this.c8.a6._inner[h].ad - q);
                    }
                }
            }
            for (let r = this.c8.a7.count - this.c8.bl; r < this.c8.a7.count; r++) {
                g.add(r);
            }
            this.cx = g.toArray();
            return this.cx;
        }
        isExclusivelySticky(a) {
            let b = this.getRowType(a);
            return b == 1 || b == 2 || b == 4 || (this.isSectionSummaryRowsAtBottom && b == 5);
        }
        getRowType(a) {
            if (a < 0) {
                return 0;
            }
            let b = this.getItemAtIndex(a);
            let item_ = b;
            if ((item_ != null && item_.$$isSpecialRow !== undefined)) {
                let c = b.rowType;
                if (this.isSectionHeaderNormalRow && c == 1) {
                    return 0;
                }
                return c;
            }
            return 0;
        }
        setIsRowExpandedAtIndex(a, b) {
            if (this.isSectionCollapsable && this.c8 != null && this.c8.a7.count > 0 && this.c8.a7.count > a) {
                this.c8.cb(a, b);
            }
        }
        getIsRowExpandedAtIndex(a) {
            if (this.c8 != null && this.c8.a7.count > 0 && this.c8.a7.count > a) {
                return this.c8.ak(a);
            }
            return true;
        }
        getRowLevel(a) {
            if (a < 0) {
                return 0;
            }
            let b = this.getItemAtIndex(a);
            let item_ = b;
            if ((item_ != null && item_.$$isSpecialRow !== undefined)) {
                return b.level;
            }
            if (this.sectionHeaderDisplayMode == 1) {
                return this.groupDescriptions.k.count;
            }
            else if (this.groupDescriptions.k.count > 0) {
                return 1;
            }
            return 0;
        }
        getRootSummaryRowCount() {
            if (this.c8 != null) {
                return this.c8.bl;
            }
            return 0;
        }
        getRootSummaryResults() {
            if (this.c8 != null) {
                return this.c8.i;
            }
            return null;
        }
        getSectionSummaryResults(a) {
            if (this.c8 != null && this.c8.a6.count > 0 && a >= 0 && a < this.c8.a6.count) {
                return this.c8.a6._inner[a].i;
            }
            return null;
        }
        clone() {
            let a = new LocalDataSource();
            a.dataSource = this.dataSource;
            super.cloneProperties(a);
            if (this.dc && this.dataProvider != null && typeCast(IDataSourceClonableDataProvider_$type, this.dataProvider) !== null) {
                a.dataProvider = this.dataProvider.clone();
            }
            return a;
        }
        ar() {
            return !this.isReadOnly && this.actualBaseDataProvider != null && this.v != null;
        }
        cq(a, b) {
            if (a == 5) {
                let c = new List$1(TransactionType_$type, 0);
                let d = new List$1(Base.$, 0);
                let e = b;
                let f = e.a;
                for (let g = 0; g < f.length; g++) {
                    if (f[g].transactionType == 1) {
                        let h = f[g].id;
                        let i = this.getItemFromKey(h);
                        if (i != null) {
                            let j = f[g].value;
                            let k = this.indexOfItem(i);
                            let l = null;
                            if (this.c8 != null && k > -1) {
                                l = this.c8.w(k);
                                for (let m = 0; m < this.summaryDescriptions.k.count; m++) {
                                    let n = this.summaryDescriptions.k.item(m);
                                    if (n.operand == 5 || j.containsKey(n.propertyName)) {
                                        this.c8.cm(m, k, i, false, l);
                                    }
                                }
                            }
                            for (let o of fromEnum(j)) {
                                this.actualDataProvider.setItemValue(i, o.key, o.value);
                            }
                            if (l != null && this.c8 != null && k > -1) {
                                for (let p = 0; p < this.summaryDescriptions.k.count; p++) {
                                    let q = this.summaryDescriptions.k.item(p);
                                    if (q.operand == 5 || j.containsKey(q.propertyName)) {
                                        this.c8.cm(p, k, i, true, l);
                                    }
                                }
                            }
                            if (k > -1) {
                                this.onBroadcastSetItem(k, i, i);
                            }
                            d.add1(i);
                            c.add(1);
                            if (this.dl.count > 0) {
                                let r = this.c7();
                                for (let s = 0; s < this.dl.count; s++) {
                                    if (r.h(this.dl._inner[s], h) == 0) {
                                        let t = this.getStickyRows();
                                        for (let u = 0; u < t.length; u++) {
                                            let v = t[u];
                                            let w = typeCast(DataSourceSpecialRow.$, this.c8.a7.item(v));
                                            if (w != null && w.rowType == 3 && w.targetRow == i) {
                                                this.onBroadcastSetItem(v, w, w);
                                                break;
                                            }
                                        }
                                        break;
                                    }
                                }
                            }
                        }
                    }
                    else if (f[g].transactionType == TransactionType.Delete) {
                        let x = f[g].id;
                        let y = this.indexOfKey(x);
                        if (y > -1) {
                            let z = this.getItemAtIndex(y);
                            this.actualDataProvider.removeItem(z);
                            this.notifyRemoveItem(y, z);
                            d.add1(z);
                            c.add(TransactionType.Delete);
                        }
                    }
                    else if (f[g].transactionType == 0) {
                        let aa = f[g].id;
                        let ab = aa[0];
                        if (f[g].value != null) {
                            let ac = f[g].value;
                            for (let ad of fromEnum(ac)) {
                                this.actualDataProvider.setItemValue(ab, ad.key, ad.value);
                            }
                        }
                        this.actualDataProvider.addItem(ab);
                        d.add1(ab);
                        c.add(0);
                    }
                }
                if (f.length > 0) {
                    this.b2(e.id, this.getAggregatedChanges(e.id));
                }
            }
        }
    }
    LocalDataSource.$t = markType(LocalDataSource, 'LocalDataSource', BaseDataSource.$);
    return LocalDataSource;
})();
/**
 * @hidden
 */
export let LocalDataSourceViewUpdateNotifier = /*@__PURE__*/ (() => {
    class LocalDataSourceViewUpdateNotifier extends Base {
        constructor(a) {
            super();
            this.a = null;
            this.a = a;
        }
        notifyClearItems() {
            this.a.d6();
        }
        notifyInsertItem(a, b) {
            this.a.d7(a, b);
        }
        notifyRemoveItem(a, b) {
            this.a.d8(a, b);
        }
        notifySetItem(a, b, c) {
            this.a.d9(a, b, c);
        }
    }
    LocalDataSourceViewUpdateNotifier.$t = markType(LocalDataSourceViewUpdateNotifier, 'LocalDataSourceViewUpdateNotifier', Base.$, [ISupportsDataChangeNotifications_$type]);
    return LocalDataSourceViewUpdateNotifier;
})();
/**
 * @hidden
 */
export let LocalDataSourceViewExpansionNotifier = /*@__PURE__*/ (() => {
    class LocalDataSourceViewExpansionNotifier extends Base {
        constructor(a) {
            super();
            this.a = null;
            this.a = a;
        }
        notifyRowExpansionChanged(a, b, c) {
            this.a.onRowExpansionChanged(a, b, c);
        }
    }
    LocalDataSourceViewExpansionNotifier.$t = markType(LocalDataSourceViewExpansionNotifier, 'LocalDataSourceViewExpansionNotifier', Base.$, [ISupportsExpansionChangeNotifications_$type]);
    return LocalDataSourceViewExpansionNotifier;
})();
